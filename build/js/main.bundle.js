(()=>{"use strict";const e=(e,t,r)=>{e.setAttribute(t,r)},t=e=>{const t=document.createElement("div");t.style.zIndex=1e3,t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.width="320px",t.style.height="auto",t.style.transform="translate(-50%, -50%)",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="tomato",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},r=e=>"Escape"===e.key,o=document.querySelector("#card").content.querySelector(".popup"),n=document.querySelector("#map-canvas"),a=L.map(n),c=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),l=L.marker({lat:35.6817,lng:139.753882},{draggable:!0,icon:c}),s=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),d=document.querySelector(".ad-form").querySelector("#address"),i=[],u=e=>{e.slice(0,10).forEach((e=>{const t=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:s});t.addTo(a).bindPopup((e=>{const t=o.cloneNode(!0);return((e,t)=>{var r;t.querySelector(".popup__avatar").src=e.author.avatar,t.querySelector(".popup__features").innerHTML="",t.querySelector(".popup__title").textContent=e.offer.title,t.querySelector(".popup__text--address").textContent=e.offer.address,t.querySelector(".popup__text--price").innerHTML=e.offer.price+" <span>₽/ночь</span>",t.querySelector(".popup__type").textContent="flat"===(r=e).offer.type?"Квартира":"bungalow"===r.offer.type?"Бунгало":"palace"===r.offer.type?"Дворец":"house"===r.offer.type?"Дом":void 0,t.querySelector(".popup__text--capacity").textContent=`${e.offer.rooms} команты для ${e.offer.guests} гостей`,t.querySelector(".popup__text--time").textContent=`Заезд после ${e.offer.checkin}, выезд до ${e.offer.checkout}`,t.querySelector(".popup__description").textContent=e.offer.description,t.querySelector(".popup__photos").innerHTML=""})(e,t),((e,t)=>{const r=t.querySelector(".popup__features");0===e.offer.features.length&&r.remove(),e.offer.features.forEach((e=>{const t=`<li class="popup__feature popup__feature--${e}"></li>`;r.insertAdjacentHTML("beforeend",t)}))})(e,t),((e,t)=>{const r=t.querySelector(".popup__photos");0===e.offer.photos.length&&r.remove(),e.offer.photos.forEach(((e,t)=>{const o=`<img src="${e}" class="popup__photo" width="45" height="40" alt="Фотография жилья ${t+1}">`;r.insertAdjacentHTML("beforeend",o)}))})(e,t),t})(e),{keepInView:!0}),i.push(t)}))},p=()=>{l.setLatLng([35.6817,139.753882])},f=["gif","jpg","jpeg","png"],m=document.querySelector("#avatar"),y=document.querySelector(".ad-form-header__preview > img"),v=document.querySelector("#images"),h=document.querySelector(".ad-form__photo"),g=()=>{y.src="img/muffin-grey.svg"},b=()=>{h.style.backgroundImage=""},S=document.querySelector(".ad-form"),q=S.querySelectorAll("fieldset"),E=document.querySelector(".ad-form__reset"),k=document.querySelector(".map__filters"),A=k.querySelectorAll("select"),w=k.querySelectorAll("fieldset"),x=document.querySelector("#room_number"),T=document.querySelector("#capacity"),$=()=>{S.classList.add("ad-form--disabled"),q.forEach((e=>{e.setAttribute("disabled","disabled")})),k.classList.add("map__filters--disabled"),w.forEach((e=>{e.setAttribute("disabled","disabled")})),A.forEach((e=>{e.setAttribute("disabled","disabled")}))},C=()=>{S.classList.remove("ad-form--disabled"),q.forEach((e=>{e.removeAttribute("disabled")}))},D=document.querySelector("#type"),j=document.querySelector("#price"),M=()=>"bungalow"===D.value?"0":"flat"===D.value?"1000":"palace"===D.value?"10000":"house"===D.value?"5000":void 0,z=document.querySelector("#timein"),F=document.querySelector("#timeout"),H=(e,t)=>{e.addEventListener("change",(()=>{let r=t.options;for(let t=0;t<r.length;t++)r[t].value===e.value&&(r[t].selected=!0)}))},N=document.querySelector("#error").content.querySelector(".error"),I=document.querySelector("main"),R=e=>{r(e)&&(e.preventDefault(),U())},U=()=>{document.querySelector(".error").remove(),document.removeEventListener("keydown",R)},O=e=>{U(),e.target.removeEventListener("click",O)},P=()=>{const e=N.cloneNode(!0);I.append(e),document.querySelector(".error__button").addEventListener("click",O),document.addEventListener("keydown",R)},V=document.querySelector("#success").content.querySelector(".success"),W=()=>{document.querySelector(".success").remove(),document.removeEventListener("keydown",B),document.removeEventListener("click",G)},G=()=>{W()},B=e=>{r(e)&&(e.preventDefault(),W())},J=()=>{const e=V.cloneNode(!0);I.append(e),document.addEventListener("keydown",B),document.addEventListener("click",G),S.reset(),p(),g(),b()},K=document.querySelector(".map__filters"),Q=K.querySelector("#housing-type"),X=K.querySelector("#housing-price"),Y=K.querySelector("#housing-rooms"),Z=K.querySelector("#housing-guests"),ee=e=>{if("any"===Q.value||e.offer.type===Q.value)return!0},te=e=>"any"===X.value||("middle"===X.value?e.offer.price>=1e4&&e.offer.price<5e4:"low"===X.value?e.offer.price<1e4:"high"===X.value&&e.offer.price>=5e4),re=e=>{const t=K.querySelectorAll(".map__checkbox:checked");if(0===t.length)return!0;{let r=0;if(t.forEach((t=>{e.offer.features.includes(t.value)&&r++})),r===t.length)return!0}},oe=e=>{if("any"===Y.value||e.offer.rooms===Number(Y.value))return!0},ne=e=>{if("any"===Z.value||e.offer.guests===Number(Z.value))return!0};$();const ae=e=>{var t;u(e),t=e,K.addEventListener("change",_.debounce((()=>(e=>{const t=e.filter(ee).filter(te).filter(oe).filter(ne).filter(re);i.forEach((e=>{e.remove()})),u(t)})(t)),500)),k.classList.remove("map__filters--disabled"),w.forEach((e=>{e.removeAttribute("disabled")})),A.forEach((e=>{e.removeAttribute("disabled")}))};document.addEventListener("DOMContentLoaded",(()=>{var r,o;(()=>{try{a.on("load",(()=>{var e;C(),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),l.addTo(a),e=d,l.on("moveend",(t=>{const r=t.target.getLatLng(),o=r.lat.toFixed(5),n=r.lng.toFixed(5);e.value=`${o}, ${n}`}))})).setView({lat:35.6817,lng:139.75388},13)}catch(e){t(e),$()}})(),r=ae,o=t,fetch("https://22.javascript.pages.academy/keksobooking/data",{method:"GET",credentials:"same-origin"}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((e=>{r(e)})).catch((e=>{o(e)})),e(j,"placeholder",M()),e(j,"min",M()),D.addEventListener("change",(()=>{e(j,"placeholder",M()),e(j,"min",M())})),H(z,F),H(F,z),x.addEventListener("change",(()=>{((e,t)=>{const r=t.options;if(1==e.value)for(let e=0;e<r.length;e++){const t=r[e];1!=t.value?(t.selected=!1,t.setAttribute("disabled","disabled")):(t.removeAttribute("disabled","disabled"),t.selected=!0)}if(2==e.value)for(let e=0;e<r.length;e++){const t=r[e];1==t.value||2==t.value?(t.selected=!0,t.removeAttribute("disabled","disabled")):(t.setAttribute("disabled","disabled"),t.selected=!1)}if(3==e.value)for(let e=0;e<r.length;e++){const t=r[e];0==t.value?(t.selected=!1,t.setAttribute("disabled","disabled")):(t.removeAttribute("disabled","disabled"),t.selected=!0)}if(100==e.value)for(let e=0;e<r.length;e++){const t=r[e];0==t.value?(t.selected=!0,t.removeAttribute("disabled","disabled")):(t.setAttribute("disabled","disabled"),t.selected=!0)}})(x,T)})),((e,t,r)=>{S.addEventListener("submit",(o=>{o.preventDefault(),((e,t,r,o)=>{fetch(e,{method:"POST",body:t}).then((e=>{e.ok?r():o()})).catch((()=>{o()}))})(e,new FormData(o.target),t,r)}))})("https://22.javascript.pages.academy/keksobooking",J,P),E.addEventListener("click",(e=>{e.preventDefault(),S.reset(),p(),g(),b()})),m.addEventListener("change",(()=>{const e=m.files[0],t=e.name.toLowerCase();if(f.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{y.src=t.result})),t.readAsDataURL(e)}})),v.addEventListener("change",(()=>{const e=v.files[0],t=e.name.toLowerCase();if(f.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{h.style.backgroundImage=`url('${t.result}')`,h.style.backgroundSize="cover"})),t.readAsDataURL(e)}}))}))})();
//# sourceMappingURL=main.bundle.js.map